"use strict";(globalThis.webpackChunkmy_profile_site=globalThis.webpackChunkmy_profile_site||[]).push([[2192],{17511:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"design-patterns/structural/flyweight","title":"Flyweight Pattern","description":"Use sharing to efficiently support a large number of fine-grained objects. A flyweight is a shared object that can be used in multiple contexts simultaneously.","source":"@site/docs/design-patterns/structural/flyweight.md","sourceDirName":"design-patterns/structural","slug":"/design-patterns/structural/flyweight","permalink":"/docs/design-patterns/structural/flyweight","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Bridge Pattern","permalink":"/docs/design-patterns/structural/bridge"},"next":{"title":"DevOps","permalink":"/docs/devops/"}}');var i=n(74848),s=n(28453);const l={sidebar_position:7},a="Flyweight Pattern",c={},o=[{value:"Problem",id:"problem",level:2},{value:"Design Principles Applied",id:"design-principles-applied",level:2},{value:"Intrinsic vs Extrinsic State",id:"intrinsic-vs-extrinsic-state",level:2},{value:"UML Diagram",id:"uml-diagram",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Example: Forest Renderer",id:"example-forest-renderer",level:3},{value:"Step 1: Separate Intrinsic from Extrinsic State",id:"step-1-separate-intrinsic-from-extrinsic-state",level:3},{value:"Step 2: Create the Flyweight Factory",id:"step-2-create-the-flyweight-factory",level:3},{value:"Step 3: Define the Context Object",id:"step-3-define-the-context-object",level:3},{value:"Step 4: Client Usage",id:"step-4-client-usage",level:3},{value:"Real-World Examples",id:"real-world-examples",level:2},{value:"Flyweight vs Similar Patterns",id:"flyweight-vs-similar-patterns",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"flyweight-pattern",children:"Flyweight Pattern"})}),"\n",(0,i.jsx)(t.p,{children:"Use sharing to efficiently support a large number of fine-grained objects. A flyweight is a shared object that can be used in multiple contexts simultaneously."}),"\n",(0,i.jsx)(t.h2,{id:"problem",children:"Problem"}),"\n",(0,i.jsx)(t.p,{children:"You need to create a very large number of objects that share common state, and the memory cost of storing all that repeated state becomes prohibitive."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Common Scenarios:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Rendering large numbers of characters in a text editor"}),"\n",(0,i.jsx)(t.li,{children:"Particles in a game engine (bullets, sparks, leaves)"}),"\n",(0,i.jsx)(t.li,{children:"Tree or tile objects in a map renderer"}),"\n",(0,i.jsx)(t.li,{children:"Network connection pools"}),"\n",(0,i.jsx)(t.li,{children:"Caching and interning of immutable objects"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"design-principles-applied",children:"Design Principles Applied"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Separation of Concerns"})," - Intrinsic (shared) state is separated from extrinsic (context-specific) state"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Single Responsibility"})," - ",(0,i.jsx)(t.code,{children:"FlyweightFactory"})," manages the shared pool; ",(0,i.jsx)(t.code,{children:"Flyweight"})," manages shared state"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Encapsulation"})," - Clients interact through the factory, not the pool directly"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"intrinsic-vs-extrinsic-state",children:"Intrinsic vs Extrinsic State"}),"\n",(0,i.jsx)(t.p,{children:"The key to Flyweight is splitting object state into two categories:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"State"}),(0,i.jsx)(t.th,{children:"Stored in"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"Intrinsic"})}),(0,i.jsx)(t.td,{children:"Flyweight object"}),(0,i.jsx)(t.td,{children:"Shared, immutable, context-independent"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"Extrinsic"})}),(0,i.jsx)(t.td,{children:"Client or context"}),(0,i.jsx)(t.td,{children:"Unique per use, passed in at call time"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"uml-diagram",children:"UML Diagram"}),"\n",(0,i.jsx)(t.mermaid,{value:'classDiagram\n    class Flyweight {\n        <<interface>>\n        +operation(extrinsicState)\n    }\n    class ConcreteFlyweight {\n        -intrinsicState\n        +operation(extrinsicState)\n    }\n    class UnsharedConcreteFlyweight {\n        -allState\n        +operation(extrinsicState)\n    }\n    class FlyweightFactory {\n        -flyweights\n        +getFlyweight(key) Flyweight\n    }\n    class Client {\n        <<actor>>\n    }\n    note for Client "Represents any code that uses the pattern, not a concrete class"\n    Client --\x3e FlyweightFactory\n    Client --\x3e Flyweight\n    FlyweightFactory o-- ConcreteFlyweight : pool\n    Flyweight <|.. ConcreteFlyweight : implements\n    Flyweight <|.. UnsharedConcreteFlyweight : implements'}),"\n",(0,i.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,i.jsx)(t.h3,{id:"example-forest-renderer",children:"Example: Forest Renderer"}),"\n",(0,i.jsx)(t.p,{children:"A game renders thousands of trees. Each tree has a type (shared) and a position (unique)."}),"\n",(0,i.jsx)(t.h3,{id:"step-1-separate-intrinsic-from-extrinsic-state",children:"Step 1: Separate Intrinsic from Extrinsic State"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'// Intrinsic state \u2014 shared across all trees of the same type\npublic class TreeType {\n    private final String name;\n    private final String color;\n    private final String texture;\n\n    public TreeType(String name, String color, String texture) {\n        this.name = name;\n        this.color = color;\n        this.texture = texture;\n    }\n\n    public void draw(int x, int y) {\n        System.out.printf("Drawing %s tree [color=%s] at (%d, %d)%n",\n            name, color, x, y);\n    }\n}\n'})}),"\n",(0,i.jsx)(t.h3,{id:"step-2-create-the-flyweight-factory",children:"Step 2: Create the Flyweight Factory"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'// Factory manages the shared pool of TreeType objects\npublic class TreeFactory {\n    private static final Map<String, TreeType> treeTypes = new HashMap<>();\n\n    public static TreeType getTreeType(String name, String color, String texture) {\n        String key = name + "_" + color;\n        return treeTypes.computeIfAbsent(key,\n            k -> new TreeType(name, color, texture));\n    }\n\n    public static int getPoolSize() {\n        return treeTypes.size();\n    }\n}\n'})}),"\n",(0,i.jsx)(t.h3,{id:"step-3-define-the-context-object",children:"Step 3: Define the Context Object"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"// Extrinsic state \u2014 unique per tree instance (position)\npublic class Tree {\n    private final int x;\n    private final int y;\n    private final TreeType type; // reference to shared flyweight\n\n    public Tree(int x, int y, TreeType type) {\n        this.x = x;\n        this.y = y;\n        this.type = type;\n    }\n\n    public void draw() {\n        type.draw(x, y);\n    }\n}\n"})}),"\n",(0,i.jsx)(t.h3,{id:"step-4-client-usage",children:"Step 4: Client Usage"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'public class Forest {\n    private final List<Tree> trees = new ArrayList<>();\n\n    public void plantTree(int x, int y, String name, String color, String texture) {\n        TreeType type = TreeFactory.getTreeType(name, color, texture);\n        trees.add(new Tree(x, y, type));\n    }\n\n    public void draw() {\n        trees.forEach(Tree::draw);\n    }\n}\n\n// Plant 1,000,000 trees \u2014 only 3 TreeType objects are created\nForest forest = new Forest();\nfor (int i = 0; i < 1_000_000; i++) {\n    forest.plantTree(\n        (int)(Math.random() * 2000),\n        (int)(Math.random() * 2000),\n        "Oak", "dark green", "oak_texture.png"\n    );\n}\nforest.plantTree(100, 200, "Pine", "green", "pine_texture.png");\nforest.plantTree(300, 400, "Birch", "white", "birch_texture.png");\n\nSystem.out.println("TreeType objects in pool: " + TreeFactory.getPoolSize()); // 3\n'})}),"\n",(0,i.jsx)(t.h2,{id:"real-world-examples",children:"Real-World Examples"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.code,{children:"String.intern()"})})," \u2014 Java's string pool interns string literals so identical values share one object"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.code,{children:"Integer.valueOf()"})})," \u2014 caches ",(0,i.jsx)(t.code,{children:"Integer"})," objects for values -128 to 127"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsxs)(t.strong,{children:[(0,i.jsx)(t.code,{children:"Character"})," objects in text editors"]})," \u2014 glyph objects for each character shape are shared across all uses of that character"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Game engines"})," \u2014 particle systems reuse flyweight descriptors for bullet/spark appearance"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"flyweight-vs-similar-patterns",children:"Flyweight vs Similar Patterns"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Pattern"}),(0,i.jsx)(t.th,{children:"Intent"}),(0,i.jsx)(t.th,{children:"Sharing"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"Flyweight"})}),(0,i.jsx)(t.td,{children:"Share fine-grained objects to reduce memory"}),(0,i.jsx)(t.td,{children:"Explicit pool managed by factory"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"Singleton"})}),(0,i.jsx)(t.td,{children:"Ensure only one instance of a class"}),(0,i.jsx)(t.td,{children:"One instance only, not keyed"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"Proxy"})}),(0,i.jsx)(t.td,{children:"Control access to another object"}),(0,i.jsx)(t.td,{children:"Wraps one object, no pool"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"Facade"})}),(0,i.jsx)(t.td,{children:"Simplify a complex subsystem"}),(0,i.jsx)(t.td,{children:"No object sharing involved"})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var r=n(96540);const i={},s=r.createContext(i);function l(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);