"use strict";(globalThis.webpackChunkmy_profile_site=globalThis.webpackChunkmy_profile_site||[]).push([[6861],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},54513:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"testing/fundamentals/test-doubles","title":"Mocking and Test Doubles","description":"Learn how to isolate code under test using mocks, stubs, spies, and other test doubles across Java, JavaScript, and TypeScript.","source":"@site/docs/testing/fundamentals/test-doubles.md","sourceDirName":"testing/fundamentals","slug":"/testing/fundamentals/test-doubles","permalink":"/docs/testing/fundamentals/test-doubles","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Behavior-Driven Development (BDD)","permalink":"/docs/testing/fundamentals/bdd"},"next":{"title":"Testing Practices","permalink":"/docs/testing/practices/"}}');var r=s(74848),i=s(28453);const o={sidebar_position:5},c="Mocking and Test Doubles",a={},l=[{value:"What are Test Doubles?",id:"what-are-test-doubles",level:2},{value:"Types of Test Doubles",id:"types-of-test-doubles",level:2},{value:"1. Dummy",id:"1-dummy",level:3},{value:"2. Stub",id:"2-stub",level:3},{value:"3. Spy",id:"3-spy",level:3},{value:"4. Mock",id:"4-mock",level:3},{value:"5. Fake",id:"5-fake",level:3},{value:"Java - Mockito",id:"java---mockito",level:2},{value:"Setup",id:"setup",level:3},{value:"Creating Mocks",id:"creating-mocks",level:3},{value:"Stubbing Methods",id:"stubbing-methods",level:3},{value:"Stubbing with Arguments",id:"stubbing-with-arguments",level:3},{value:"Throwing Exceptions",id:"throwing-exceptions",level:3},{value:"Verifying Interactions",id:"verifying-interactions",level:3},{value:"Spying on Real Objects",id:"spying-on-real-objects",level:3},{value:"Answer Interface",id:"answer-interface",level:3},{value:"JavaScript - Jest",id:"javascript---jest",level:2},{value:"Creating Mocks",id:"creating-mocks-1",level:3},{value:"Manual Mocks",id:"manual-mocks",level:3},{value:"Mock Functions",id:"mock-functions",level:3},{value:"Stubbing Methods",id:"stubbing-methods-1",level:3},{value:"Spying",id:"spying",level:3},{value:"Mock Implementation",id:"mock-implementation",level:3},{value:"JavaScript - testdouble.js",id:"javascript---testdoublejs",level:2},{value:"Setup",id:"setup-1",level:3},{value:"Creating Test Doubles",id:"creating-test-doubles",level:3},{value:"Stubbing with testdouble",id:"stubbing-with-testdouble",level:3},{value:"Verification with testdouble",id:"verification-with-testdouble",level:3},{value:"Replacing Dependencies",id:"replacing-dependencies",level:3},{value:"TypeScript - Jest with Type Safety",id:"typescript---jest-with-type-safety",level:2},{value:"Setup",id:"setup-2",level:3},{value:"Type-Safe Mocks",id:"type-safe-mocks",level:3},{value:"Manual Typed Mocks",id:"manual-typed-mocks",level:3},{value:"Type-Safe Mock Functions",id:"type-safe-mock-functions",level:3},{value:"Partial Mocks",id:"partial-mocks",level:3},{value:"Spying with TypeScript",id:"spying-with-typescript",level:3},{value:"TypeScript - testdouble",id:"typescript---testdouble",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Mock at the Boundaries",id:"1-mock-at-the-boundaries",level:3},{value:"2. Don&#39;t Mock What You Don&#39;t Own",id:"2-dont-mock-what-you-dont-own",level:3},{value:"3. Use Fakes for Complex Logic",id:"3-use-fakes-for-complex-logic",level:3},{value:"4. Keep Tests Readable",id:"4-keep-tests-readable",level:3},{value:"5. Reset Mocks Between Tests",id:"5-reset-mocks-between-tests",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Repository Pattern Testing",id:"repository-pattern-testing",level:3},{value:"Service Layer Testing",id:"service-layer-testing",level:3},{value:"Comparison: Mocking Frameworks",id:"comparison-mocking-frameworks",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"mocking-and-test-doubles",children:"Mocking and Test Doubles"})}),"\n",(0,r.jsx)(n.p,{children:"Learn how to isolate code under test using mocks, stubs, spies, and other test doubles across Java, JavaScript, and TypeScript."}),"\n",(0,r.jsx)(n.h2,{id:"what-are-test-doubles",children:"What are Test Doubles?"}),"\n",(0,r.jsx)(n.p,{children:"Test doubles are objects that replace real dependencies in tests, allowing you to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Isolate"})," the code under test"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Control"})," behavior of dependencies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify"})," interactions with dependencies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Speed up"})," tests by avoiding slow operations"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Think of test doubles like stunt doubles in movies\u2014they stand in for the real thing during testing."}),"\n",(0,r.jsx)(n.h2,{id:"types-of-test-doubles",children:"Types of Test Doubles"}),"\n",(0,r.jsx)(n.h3,{id:"1-dummy",children:"1. Dummy"}),"\n",(0,r.jsx)(n.p,{children:"Objects passed around but never used. Used to fill parameter lists."}),"\n",(0,r.jsx)(n.h3,{id:"2-stub",children:"2. Stub"}),"\n",(0,r.jsx)(n.p,{children:"Provides canned answers to calls made during tests. Returns predefined values."}),"\n",(0,r.jsx)(n.h3,{id:"3-spy",children:"3. Spy"}),"\n",(0,r.jsx)(n.p,{children:"Records information about how it was called. Can verify interactions."}),"\n",(0,r.jsx)(n.h3,{id:"4-mock",children:"4. Mock"}),"\n",(0,r.jsx)(n.p,{children:"Pre-programmed with expectations about calls it will receive. Can verify behavior."}),"\n",(0,r.jsx)(n.h3,{id:"5-fake",children:"5. Fake"}),"\n",(0,r.jsx)(n.p,{children:"Working implementation, but simplified (e.g., in-memory database)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Test Doubles Spectrum                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                 \u2502\n\u2502  Dummy  \u2192  Stub  \u2192  Spy  \u2192  Mock  \u2192  Fake     \u2502\n\u2502                                                 \u2502\n\u2502  Simple \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Complex    \u2502\n\u2502  No logic \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Has logic      \u2502\n\u2502                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h2,{id:"java---mockito",children:"Java - Mockito"}),"\n",(0,r.jsx)(n.p,{children:"Mockito is the most popular mocking framework for Java."}),"\n",(0,r.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"\x3c!-- Maven --\x3e\n<dependency>\n    <groupId>org.mockito</groupId>\n    <artifactId>mockito-core</artifactId>\n    <version>5.7.0</version>\n    <scope>test</scope>\n</dependency>\n<dependency>\n    <groupId>org.mockito</groupId>\n    <artifactId>mockito-junit-jupiter</artifactId>\n    <version>5.7.0</version>\n    <scope>test</scope>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-groovy",children:"// Gradle\ntestImplementation 'org.mockito:mockito-core:5.7.0'\ntestImplementation 'org.mockito:mockito-junit-jupiter:5.7.0'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-mocks",children:"Creating Mocks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"import org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\nclass UserServiceTest {\n\n    @Mock\n    private UserRepository userRepository;\n\n    @Mock\n    private EmailService emailService;\n\n    @Test\n    void shouldCreateUser() {\n        // You can also create mocks manually\n        UserRepository repo = mock(UserRepository.class);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"stubbing-methods",children:"Stubbing Methods"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid shouldFindUserById() {\n    // Arrange - Stub the repository\n    User mockUser = new User(1L, "john@example.com", "John");\n    when(userRepository.findById(1L))\n        .thenReturn(Optional.of(mockUser));\n\n    UserService service = new UserService(userRepository);\n\n    // Act\n    User result = service.getUserById(1L);\n\n    // Assert\n    assertEquals("John", result.getName());\n}\n\n@Test\nvoid shouldHandleMultipleCalls() {\n    // Return different values on consecutive calls\n    when(userRepository.count())\n        .thenReturn(1L)\n        .thenReturn(2L)\n        .thenReturn(3L);\n\n    assertEquals(1L, userRepository.count());\n    assertEquals(2L, userRepository.count());\n    assertEquals(3L, userRepository.count());\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"stubbing-with-arguments",children:"Stubbing with Arguments"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid shouldStubBasedOnArguments() {\n    // Exact argument matching\n    when(userRepository.findById(1L))\n        .thenReturn(Optional.of(new User(1L, "john@example.com")));\n\n    // Argument matchers\n    when(userRepository.findById(anyLong()))\n        .thenReturn(Optional.empty());\n\n    // Multiple arguments\n    when(userRepository.findByEmailAndStatus(\n        eq("john@example.com"),\n        any(UserStatus.class)\n    )).thenReturn(Optional.of(new User()));\n}\n\n@Test\nvoid shouldUseArgumentCaptor() {\n    ArgumentCaptor<User> userCaptor = ArgumentCaptor.forClass(User.class);\n\n    UserService service = new UserService(userRepository);\n    service.createUser("john@example.com", "John");\n\n    // Verify and capture the argument\n    verify(userRepository).save(userCaptor.capture());\n\n    User capturedUser = userCaptor.getValue();\n    assertEquals("john@example.com", capturedUser.getEmail());\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"throwing-exceptions",children:"Throwing Exceptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid shouldHandleRepositoryException() {\n    // Stub to throw exception\n    when(userRepository.findById(anyLong()))\n        .thenThrow(new DatabaseException("Connection failed"));\n\n    UserService service = new UserService(userRepository);\n\n    assertThrows(DatabaseException.class, () -> {\n        service.getUserById(1L);\n    });\n}\n\n@Test\nvoid shouldThrowOnVoidMethod() {\n    // For void methods, use doThrow\n    doThrow(new EmailException("SMTP error"))\n        .when(emailService).sendEmail(any());\n\n    UserService service = new UserService(userRepository, emailService);\n\n    assertThrows(EmailException.class, () -> {\n        service.notifyUser(new User());\n    });\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"verifying-interactions",children:"Verifying Interactions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid shouldVerifyMethodCalls() {\n    UserService service = new UserService(userRepository, emailService);\n    service.createUser("john@example.com", "John");\n\n    // Verify method was called\n    verify(userRepository).save(any(User.class));\n\n    // Verify exact number of invocations\n    verify(emailService, times(1)).sendWelcomeEmail(any());\n\n    // Verify never called\n    verify(emailService, never()).sendPasswordResetEmail(any());\n\n    // Verify at least / at most\n    verify(userRepository, atLeast(1)).save(any());\n    verify(userRepository, atMost(3)).save(any());\n}\n\n@Test\nvoid shouldVerifyOrder() {\n    InOrder inOrder = inOrder(userRepository, emailService);\n\n    UserService service = new UserService(userRepository, emailService);\n    service.createUserWithNotification("john@example.com", "John");\n\n    // Verify order of calls\n    inOrder.verify(userRepository).save(any(User.class));\n    inOrder.verify(emailService).sendWelcomeEmail(any());\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"spying-on-real-objects",children:"Spying on Real Objects"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid shouldSpyOnRealObject() {\n    // Spy calls real methods unless stubbed\n    List<String> realList = new ArrayList<>();\n    List<String> spyList = spy(realList);\n\n    // Real method is called\n    spyList.add("one");\n    spyList.add("two");\n\n    // Verify real behavior happened\n    assertEquals(2, spyList.size());\n    verify(spyList).add("one");\n\n    // Can stub specific methods\n    when(spyList.size()).thenReturn(100);\n    assertEquals(100, spyList.size());\n}\n\n@Test\nvoid shouldSpyOnUserService() {\n    UserRepository realRepo = new InMemoryUserRepository();\n    UserRepository spyRepo = spy(realRepo);\n\n    // Most methods use real implementation\n    // But we can stub specific methods\n    doReturn(Optional.empty())\n        .when(spyRepo).findById(999L);\n\n    UserService service = new UserService(spyRepo);\n    assertFalse(service.getUserById(999L).isPresent());\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"answer-interface",children:"Answer Interface"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid shouldUseCustomAnswer() {\n    when(userRepository.save(any(User.class)))\n        .thenAnswer(invocation -> {\n            User user = invocation.getArgument(0);\n            user.setId(123L);\n            return user;\n        });\n\n    User user = new User(null, "john@example.com");\n    User saved = userRepository.save(user);\n\n    assertEquals(123L, saved.getId());\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"javascript---jest",children:"JavaScript - Jest"}),"\n",(0,r.jsx)(n.p,{children:"Jest has built-in mocking capabilities that are simple and powerful."}),"\n",(0,r.jsx)(n.h3,{id:"creating-mocks-1",children:"Creating Mocks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// userService.test.js\nconst UserRepository = require('./userRepository');\nconst EmailService = require('./emailService');\nconst UserService = require('./userService');\n\n// Mock entire modules\njest.mock('./userRepository');\njest.mock('./emailService');\n\ndescribe('UserService', () => {\n    let userService;\n    let mockUserRepository;\n    let mockEmailService;\n\n    beforeEach(() => {\n        // Clear all mocks before each test\n        jest.clearAllMocks();\n\n        // Create instances\n        mockUserRepository = new UserRepository();\n        mockEmailService = new EmailService();\n        userService = new UserService(mockUserRepository, mockEmailService);\n    });\n\n    test('should create user', async () => {\n        // Stub methods\n        const mockUser = { id: 1, email: 'john@example.com', name: 'John' };\n        mockUserRepository.save.mockResolvedValue(mockUser);\n\n        const result = await userService.createUser('john@example.com', 'John');\n\n        expect(result).toEqual(mockUser);\n        expect(mockUserRepository.save).toHaveBeenCalledWith(\n            expect.objectContaining({\n                email: 'john@example.com',\n                name: 'John'\n            })\n        );\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"manual-mocks",children:"Manual Mocks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// __mocks__/userRepository.js\nclass UserRepository {\n    constructor() {\n        this.findById = jest.fn();\n        this.save = jest.fn();\n        this.delete = jest.fn();\n    }\n}\n\nmodule.exports = UserRepository;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mock-functions",children:"Mock Functions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Mock Functions', () => {\n    test('should use mock function', () => {\n        const mockFn = jest.fn();\n\n        // Call the mock\n        mockFn('hello');\n        mockFn('world');\n\n        // Verify calls\n        expect(mockFn).toHaveBeenCalledTimes(2);\n        expect(mockFn).toHaveBeenCalledWith('hello');\n        expect(mockFn).toHaveBeenLastCalledWith('world');\n    });\n\n    test('should return values', () => {\n        const mockFn = jest.fn()\n            .mockReturnValue(42)\n            .mockReturnValueOnce(1)\n            .mockReturnValueOnce(2);\n\n        expect(mockFn()).toBe(1);  // First call\n        expect(mockFn()).toBe(2);  // Second call\n        expect(mockFn()).toBe(42); // Subsequent calls\n    });\n\n    test('should handle async functions', async () => {\n        const mockFn = jest.fn()\n            .mockResolvedValue('success')\n            .mockResolvedValueOnce('first')\n            .mockRejectedValueOnce(new Error('failed'));\n\n        await expect(mockFn()).resolves.toBe('first');\n        await expect(mockFn()).rejects.toThrow('failed');\n        await expect(mockFn()).resolves.toBe('success');\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"stubbing-methods-1",children:"Stubbing Methods"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Stubbing', () => {\n    test('should stub repository methods', async () => {\n        const mockUser = { id: 1, name: 'John' };\n\n        mockUserRepository.findById.mockResolvedValue(mockUser);\n\n        const user = await userService.getUserById(1);\n\n        expect(user).toEqual(mockUser);\n        expect(mockUserRepository.findById).toHaveBeenCalledWith(1);\n    });\n\n    test('should stub with different return values', () => {\n        mockUserRepository.count\n            .mockReturnValueOnce(1)\n            .mockReturnValueOnce(2)\n            .mockReturnValueOnce(3);\n\n        expect(mockUserRepository.count()).toBe(1);\n        expect(mockUserRepository.count()).toBe(2);\n        expect(mockUserRepository.count()).toBe(3);\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"spying",children:"Spying"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Spying', () => {\n    test('should spy on object methods', () => {\n        const userRepo = {\n            findById: (id) => ({ id, name: 'John' }),\n            save: (user) => user\n        };\n\n        // Spy on methods\n        const findByIdSpy = jest.spyOn(userRepo, 'findById');\n\n        const user = userRepo.findById(1);\n\n        expect(user.name).toBe('John');\n        expect(findByIdSpy).toHaveBeenCalledWith(1);\n\n        // Can also stub the spy\n        findByIdSpy.mockReturnValue({ id: 2, name: 'Jane' });\n        expect(userRepo.findById(1)).toEqual({ id: 2, name: 'Jane' });\n    });\n\n    test('should spy on class methods', () => {\n        class Calculator {\n            add(a, b) {\n                return a + b;\n            }\n        }\n\n        const calc = new Calculator();\n        const addSpy = jest.spyOn(calc, 'add');\n\n        calc.add(2, 3);\n\n        expect(addSpy).toHaveBeenCalledWith(2, 3);\n        expect(addSpy).toHaveReturnedWith(5);\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mock-implementation",children:"Mock Implementation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"test('should use custom implementation', () => {\n    mockUserRepository.save.mockImplementation((user) => {\n        return {\n            ...user,\n            id: Math.random(),\n            createdAt: new Date()\n        };\n    });\n\n    const user = mockUserRepository.save({ email: 'john@example.com' });\n\n    expect(user.id).toBeDefined();\n    expect(user.createdAt).toBeDefined();\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"javascript---testdoublejs",children:"JavaScript - testdouble.js"}),"\n",(0,r.jsx)(n.p,{children:"testdouble.js is an alternative to Jest mocks with a more opinionated API focused on test-driven development."}),"\n",(0,r.jsx)(n.h3,{id:"setup-1",children:"Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev testdouble\n"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-test-doubles",children:"Creating Test Doubles"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const td = require('testdouble');\n\ndescribe('UserService with testdouble', () => {\n    let userRepository;\n    let emailService;\n    let userService;\n\n    beforeEach(() => {\n        // Create test doubles\n        userRepository = td.object(['findById', 'save', 'delete']);\n        emailService = td.object(['sendWelcomeEmail', 'sendPasswordReset']);\n\n        const UserService = require('./userService');\n        userService = new UserService(userRepository, emailService);\n    });\n\n    afterEach(() => {\n        // Clean up\n        td.reset();\n    });\n\n    test('should create user', async () => {\n        // Arrange - Stub the double\n        const mockUser = { id: 1, email: 'john@example.com' };\n        td.when(userRepository.save(td.matchers.anything()))\n            .thenResolve(mockUser);\n\n        // Act\n        const result = await userService.createUser('john@example.com', 'John');\n\n        // Assert\n        expect(result).toEqual(mockUser);\n        td.verify(userRepository.save(td.matchers.contains({\n            email: 'john@example.com'\n        })));\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"stubbing-with-testdouble",children:"Stubbing with testdouble"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Stubbing with testdouble', () => {\n    test('should stub method calls', () => {\n        const calc = td.object(['add', 'subtract']);\n\n        // Stub with specific arguments\n        td.when(calc.add(2, 3)).thenReturn(5);\n        td.when(calc.add(5, 5)).thenReturn(10);\n\n        expect(calc.add(2, 3)).toBe(5);\n        expect(calc.add(5, 5)).toBe(10);\n    });\n\n    test('should use matchers', () => {\n        const repo = td.object(['findById']);\n\n        // Match any number\n        td.when(repo.findById(td.matchers.isA(Number)))\n            .thenReturn({ id: 1, name: 'User' });\n\n        expect(repo.findById(1).name).toBe('User');\n        expect(repo.findById(999).name).toBe('User');\n    });\n\n    test('should handle async', async () => {\n        const api = td.object(['fetchUser']);\n\n        td.when(api.fetchUser(1))\n            .thenResolve({ id: 1, name: 'John' });\n\n        const user = await api.fetchUser(1);\n        expect(user.name).toBe('John');\n    });\n\n    test('should throw errors', () => {\n        const service = td.object(['process']);\n\n        td.when(service.process('invalid'))\n            .thenThrow(new Error('Invalid input'));\n\n        expect(() => service.process('invalid')).toThrow('Invalid input');\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"verification-with-testdouble",children:"Verification with testdouble"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Verification', () => {\n    test('should verify method was called', () => {\n        const logger = td.object(['log', 'error']);\n\n        logger.log('Hello');\n        logger.log('World');\n\n        // Verify exact call\n        td.verify(logger.log('Hello'));\n        td.verify(logger.log('World'));\n\n        // Verify with matchers\n        td.verify(logger.log(td.matchers.isA(String)), { times: 2 });\n    });\n\n    test('should verify call count', () => {\n        const service = td.object(['notify']);\n\n        service.notify('user1');\n        service.notify('user2');\n        service.notify('user3');\n\n        td.verify(service.notify(td.matchers.anything()), { times: 3 });\n    });\n\n    test('should verify never called', () => {\n        const emailService = td.object(['send']);\n\n        // Verify method was never called\n        td.verify(emailService.send(td.matchers.anything()), { times: 0 });\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"replacing-dependencies",children:"Replacing Dependencies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"describe('Replacing modules', () => {\n    test('should replace module dependency', () => {\n        // Replace the module\n        td.replace('./userRepository');\n        const UserRepository = require('./userRepository');\n\n        // Now UserRepository is a test double\n        const repo = new UserRepository();\n        td.when(repo.findAll()).thenReturn([]);\n\n        expect(repo.findAll()).toEqual([]);\n    });\n\n    afterEach(() => {\n        td.reset();\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"typescript---jest-with-type-safety",children:"TypeScript - Jest with Type Safety"}),"\n",(0,r.jsx)(n.p,{children:"TypeScript adds type safety to your tests, catching errors at compile time."}),"\n",(0,r.jsx)(n.h3,{id:"setup-2",children:"Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev jest @types/jest ts-jest\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// jest.config.js\nmodule.exports = {\n    preset: 'ts-jest',\n    testEnvironment: 'node'\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"type-safe-mocks",children:"Type-Safe Mocks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// userService.test.ts\nimport { UserRepository } from './userRepository';\nimport { EmailService } from './emailService';\nimport { UserService } from './userService';\n\n// Mock modules\njest.mock('./userRepository');\njest.mock('./emailService');\n\ndescribe('UserService', () => {\n    let userService: UserService;\n    let mockUserRepository: jest.Mocked<UserRepository>;\n    let mockEmailService: jest.Mocked<EmailService>;\n\n    beforeEach(() => {\n        // Create typed mocks\n        mockUserRepository = new UserRepository() as jest.Mocked<UserRepository>;\n        mockEmailService = new EmailService() as jest.Mocked<EmailService>;\n\n        userService = new UserService(mockUserRepository, mockEmailService);\n    });\n\n    test('should create user', async () => {\n        const mockUser: User = {\n            id: 1,\n            email: 'john@example.com',\n            name: 'John'\n        };\n\n        mockUserRepository.save.mockResolvedValue(mockUser);\n\n        const result = await userService.createUser('john@example.com', 'John');\n\n        expect(result).toEqual(mockUser);\n        expect(mockUserRepository.save).toHaveBeenCalledWith(\n            expect.objectContaining({\n                email: 'john@example.com',\n                name: 'John'\n            })\n        );\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"manual-typed-mocks",children:"Manual Typed Mocks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// __mocks__/userRepository.ts\nimport { User } from '../types';\n\nexport class UserRepository {\n    findById = jest.fn<Promise<User | null>, [number]>();\n    save = jest.fn<Promise<User>, [User]>();\n    delete = jest.fn<Promise<void>, [number]>();\n    findAll = jest.fn<Promise<User[]>, []>();\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"type-safe-mock-functions",children:"Type-Safe Mock Functions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"describe('Type-Safe Mocks', () => {\n    test('should use typed mock function', () => {\n        // Explicitly typed mock\n        const mockFn = jest.fn<string, [number, string]>();\n\n        mockFn.mockReturnValue('result');\n\n        const result = mockFn(1, 'test');\n\n        expect(result).toBe('result');\n        expect(mockFn).toHaveBeenCalledWith(1, 'test');\n    });\n\n    test('should mock interface', () => {\n        interface Logger {\n            log(message: string): void;\n            error(message: string, error: Error): void;\n        }\n\n        const mockLogger: jest.Mocked<Logger> = {\n            log: jest.fn(),\n            error: jest.fn()\n        };\n\n        mockLogger.log('Hello');\n        mockLogger.error('Error occurred', new Error('test'));\n\n        expect(mockLogger.log).toHaveBeenCalledWith('Hello');\n        expect(mockLogger.error).toHaveBeenCalledWith(\n            'Error occurred',\n            expect.any(Error)\n        );\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"partial-mocks",children:"Partial Mocks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"describe('Partial Mocks', () => {\n    test('should create partial mock', () => {\n        const partialUser: Partial<User> = {\n            email: 'john@example.com'\n        };\n\n        mockUserRepository.save.mockResolvedValue(partialUser as User);\n\n        // TypeScript knows this is a User\n        const user = await userService.createUser('john@example.com', 'John');\n        expect(user.email).toBe('john@example.com');\n    });\n\n    test('should use Pick utility type', () => {\n        type UserDTO = Pick<User, 'email' | 'name'>;\n\n        const dto: UserDTO = {\n            email: 'john@example.com',\n            name: 'John'\n        };\n\n        mockUserRepository.save.mockImplementation(async (user: User) => ({\n            ...user,\n            id: 1\n        }));\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"spying-with-typescript",children:"Spying with TypeScript"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"describe('Spying', () => {\n    test('should spy on class method', () => {\n        class Calculator {\n            add(a: number, b: number): number {\n                return a + b;\n            }\n\n            multiply(a: number, b: number): number {\n                return a * b;\n            }\n        }\n\n        const calc = new Calculator();\n        const addSpy = jest.spyOn(calc, 'add');\n\n        calc.add(2, 3);\n\n        expect(addSpy).toHaveBeenCalledWith(2, 3);\n        expect(addSpy).toHaveReturnedWith(5);\n\n        // TypeScript ensures type safety\n        // calc.add('2', '3');  // \u274c Compile error\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"typescript---testdouble",children:"TypeScript - testdouble"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import * as td from 'testdouble';\nimport { UserRepository } from './userRepository';\nimport { User } from './types';\n\ndescribe('UserService with testdouble', () => {\n    let userRepository: UserRepository;\n\n    beforeEach(() => {\n        userRepository = td.object<UserRepository>();\n    });\n\n    afterEach(() => {\n        td.reset();\n    });\n\n    test('should find user by id', async () => {\n        const mockUser: User = {\n            id: 1,\n            email: 'john@example.com',\n            name: 'John'\n        };\n\n        td.when(userRepository.findById(1)).thenResolve(mockUser);\n\n        const result = await userRepository.findById(1);\n\n        expect(result).toEqual(mockUser);\n    });\n\n    test('should verify with matchers', () => {\n        const logger = td.object<{ log: (msg: string) => void }>();\n\n        logger.log('Hello');\n\n        td.verify(logger.log(td.matchers.isA(String)));\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-mock-at-the-boundaries",children:"1. Mock at the Boundaries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u2705 Good - Mock external dependencies\n@Test\nvoid shouldProcessPayment() {\n    PaymentGateway mockGateway = mock(PaymentGateway.class);\n    when(mockGateway.charge(any())).thenReturn(true);\n\n    PaymentService service = new PaymentService(mockGateway);\n    assertTrue(service.processPayment(order));\n}\n\n// \u274c Bad - Mocking internal classes\n@Test\nvoid shouldCalculateTotal() {\n    OrderCalculator mockCalc = mock(OrderCalculator.class);\n    // Testing implementation details\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-dont-mock-what-you-dont-own",children:"2. Don't Mock What You Don't Own"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - Mocking third-party library\nconst axios = require('axios');\njest.mock('axios');\n\n// \u2705 Good - Create wrapper and mock your wrapper\nclass HttpClient {\n    async get(url) {\n        return axios.get(url);\n    }\n}\n\nconst mockHttpClient = {\n    get: jest.fn()\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-use-fakes-for-complex-logic",children:"3. Use Fakes for Complex Logic"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good - Fake implementation\nclass InMemoryUserRepository implements UserRepository {\n    private users: Map<number, User> = new Map();\n\n    async save(user: User): Promise<User> {\n        const id = this.users.size + 1;\n        const savedUser = { ...user, id };\n        this.users.set(id, savedUser);\n        return savedUser;\n    }\n\n    async findById(id: number): Promise<User | null> {\n        return this.users.get(id) || null;\n    }\n}\n\n// Use in tests\ntest('should create and retrieve user', async () => {\n    const repo = new InMemoryUserRepository();\n    const service = new UserService(repo);\n\n    const created = await service.createUser('john@example.com', 'John');\n    const found = await service.getUserById(created.id);\n\n    expect(found).toEqual(created);\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-keep-tests-readable",children:"4. Keep Tests Readable"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u2705 Good - Clear and readable\n@Test\nvoid shouldRejectInvalidEmail() {\n    EmailValidator mockValidator = mock(EmailValidator.class);\n    when(mockValidator.isValid("invalid")).thenReturn(false);\n\n    UserService service = new UserService(mockValidator);\n\n    assertThrows(ValidationException.class, () -> {\n        service.registerUser("invalid", "password");\n    });\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"5-reset-mocks-between-tests",children:"5. Reset Mocks Between Tests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - Reset in beforeEach\nbeforeEach(() => {\n    jest.clearAllMocks();\n    // or jest.resetAllMocks();\n});\n\n// TypeScript + testdouble\nafterEach(() => {\n    td.reset();\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"repository-pattern-testing",children:"Repository Pattern Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid shouldCacheUserLookup() {\n    UserRepository mockRepo = mock(UserRepository.class);\n    Cache mockCache = mock(Cache.class);\n\n    User user = new User(1L, "john@example.com");\n    when(mockCache.get("user:1")).thenReturn(null);\n    when(mockRepo.findById(1L)).thenReturn(Optional.of(user));\n\n    CachedUserRepository cachedRepo = new CachedUserRepository(mockRepo, mockCache);\n    User result = cachedRepo.findById(1L);\n\n    verify(mockCache).get("user:1");\n    verify(mockRepo).findById(1L);\n    verify(mockCache).put("user:1", user);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"service-layer-testing",children:"Service Layer Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"describe('OrderService', () => {\n    test('should create order and send notification', async () => {\n        const mockOrderRepo: jest.Mocked<OrderRepository> = {\n            save: jest.fn()\n        };\n\n        const mockNotificationService: jest.Mocked<NotificationService> = {\n            sendOrderConfirmation: jest.fn()\n        };\n\n        const order: Order = {\n            id: 1,\n            items: [{ productId: 1, quantity: 2 }],\n            total: 100\n        };\n\n        mockOrderRepo.save.mockResolvedValue(order);\n\n        const service = new OrderService(mockOrderRepo, mockNotificationService);\n        const result = await service.createOrder(order);\n\n        expect(mockOrderRepo.save).toHaveBeenCalledWith(order);\n        expect(mockNotificationService.sendOrderConfirmation)\n            .toHaveBeenCalledWith(order);\n    });\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"comparison-mocking-frameworks",children:"Comparison: Mocking Frameworks"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Feature"}),(0,r.jsx)(n.th,{children:"Mockito (Java)"}),(0,r.jsx)(n.th,{children:"Jest (JS/TS)"}),(0,r.jsx)(n.th,{children:"testdouble.js"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Setup Complexity"}),(0,r.jsx)(n.td,{children:"Medium"}),(0,r.jsx)(n.td,{children:"Low"}),(0,r.jsx)(n.td,{children:"Low"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Type Safety (TS)"}),(0,r.jsx)(n.td,{children:"N/A"}),(0,r.jsx)(n.td,{children:"Good"}),(0,r.jsx)(n.td,{children:"Good"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"API Style"}),(0,r.jsx)(n.td,{children:"Fluent"}),(0,r.jsx)(n.td,{children:"Simple"}),(0,r.jsx)(n.td,{children:"Explicit"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Spy Support"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Argument Matchers"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Built-in Runner"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Verification"}),(0,r.jsx)(n.td,{children:"Explicit"}),(0,r.jsx)(n.td,{children:"Explicit"}),(0,r.jsx)(n.td,{children:"Explicit"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Learning Curve"}),(0,r.jsx)(n.td,{children:"Medium"}),(0,r.jsx)(n.td,{children:"Low"}),(0,r.jsx)(n.td,{children:"Low"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Community"}),(0,r.jsx)(n.td,{children:"Large"}),(0,r.jsx)(n.td,{children:"Very Large"}),(0,r.jsx)(n.td,{children:"Medium"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Test Doubles"})," are essential for:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Isolating code under test"}),"\n",(0,r.jsx)(n.li,{children:"Controlling dependencies"}),"\n",(0,r.jsx)(n.li,{children:"Speeding up tests"}),"\n",(0,r.jsx)(n.li,{children:"Making tests deterministic"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Choose the right tool:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Java"}),": Mockito (standard choice)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JavaScript"}),": Jest (built-in, simple)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TypeScript"}),": Jest with types (best type safety)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TDD-focused"}),": testdouble.js (explicit, opinionated)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Takeaway:"})," Mock external dependencies, not your own code. Use fakes for complex logic, mocks for verification, and stubs for simple return values."]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/docs/testing/fundamentals/testing-basics",children:"Testing Fundamentals"})})," - Core testing concepts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/docs/testing/fundamentals/tdd",children:"TDD Guide"})})," - Write tests first with mocks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/docs/languages/java/testing/junit5/",children:"JUnit 5 Guide"})})," - Java testing framework"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);