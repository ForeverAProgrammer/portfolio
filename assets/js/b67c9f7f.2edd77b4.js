"use strict";(globalThis.webpackChunkmy_profile_site=globalThis.webpackChunkmy_profile_site||[]).push([[3947],{3830:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"devops/monitoring/index","title":"Monitoring & Logging","description":"Best practices for observability using Prometheus, Grafana, and ELK stack.","source":"@site/docs/devops/monitoring/index.md","sourceDirName":"devops/monitoring","slug":"/devops/monitoring/","permalink":"/portfolio/docs/devops/monitoring/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Ansible","permalink":"/portfolio/docs/devops/infrastructure-as-code/ansible"},"next":{"title":"DevOps Security","permalink":"/portfolio/docs/devops/security"}}');var i=r(4848),t=r(8453);const a={sidebar_position:5},l="Monitoring & Logging",o={},c=[{value:"Why Observability Matters",id:"why-observability-matters",level:2},{value:"The Three Pillars of Observability",id:"the-three-pillars-of-observability",level:2},{value:"Prometheus",id:"prometheus",level:2},{value:"What is Prometheus?",id:"what-is-prometheus",level:3},{value:"Installation",id:"installation",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Instrumenting Your Application",id:"instrumenting-your-application",level:3},{value:"PromQL Queries",id:"promql-queries",level:3},{value:"Grafana",id:"grafana",level:2},{value:"Installation",id:"installation-1",level:3},{value:"Connecting to Prometheus",id:"connecting-to-prometheus",level:3},{value:"Creating Dashboards",id:"creating-dashboards",level:3},{value:"Popular Community Dashboards",id:"popular-community-dashboards",level:3},{value:"ELK Stack (Elasticsearch, Logstash, Kibana)",id:"elk-stack-elasticsearch-logstash-kibana",level:2},{value:"Docker Compose Setup",id:"docker-compose-setup",level:3},{value:"Logstash Configuration",id:"logstash-configuration",level:3},{value:"Application Logging",id:"application-logging",level:3},{value:"Loki (Lightweight Alternative to ELK)",id:"loki-lightweight-alternative-to-elk",level:2},{value:"Docker Compose with Loki",id:"docker-compose-with-loki",level:3},{value:"Alerting",id:"alerting",level:2},{value:"Prometheus Alerting Rules",id:"prometheus-alerting-rules",level:3},{value:"Alertmanager Configuration",id:"alertmanager-configuration",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Label Cardinality",id:"1-label-cardinality",level:3},{value:"2. Structured Logging",id:"2-structured-logging",level:3},{value:"3. Log Levels",id:"3-log-levels",level:3},{value:"4. Sampling",id:"4-sampling",level:3},{value:"5. Retention Policies",id:"5-retention-policies",level:3},{value:"Distributed Tracing",id:"distributed-tracing",level:2},{value:"Jaeger Setup",id:"jaeger-setup",level:3},{value:"OpenTelemetry Integration",id:"opentelemetry-integration",level:3},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"monitoring--logging",children:"Monitoring & Logging"})}),"\n",(0,i.jsx)(n.p,{children:"Best practices for observability using Prometheus, Grafana, and ELK stack."}),"\n",(0,i.jsx)(n.h2,{id:"why-observability-matters",children:"Why Observability Matters"}),"\n",(0,i.jsx)(n.p,{children:"Observability is crucial for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Understanding system behavior"}),"\n",(0,i.jsx)(n.li,{children:"Detecting and diagnosing issues"}),"\n",(0,i.jsx)(n.li,{children:"Performance optimization"}),"\n",(0,i.jsx)(n.li,{children:"Capacity planning"}),"\n",(0,i.jsx)(n.li,{children:"SLA/SLO tracking"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"the-three-pillars-of-observability",children:"The Three Pillars of Observability"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metrics"})," - Numerical measurements over time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Logs"})," - Discrete events with context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Traces"})," - Request flow through distributed systems"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prometheus",children:"Prometheus"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-prometheus",children:"What is Prometheus?"}),"\n",(0,i.jsx)(n.p,{children:"Prometheus is an open-source monitoring and alerting toolkit designed for reliability and scalability."}),"\n",(0,i.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.p,{children:"Using Docker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  -p 9090:9090 \\\n  -v prometheus.yml:/etc/prometheus/prometheus.yml \\\n  prom/prometheus\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"prometheus.yml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n\n  - job_name: 'node-exporter'\n    static_configs:\n      - targets: ['localhost:9100']\n\n  - job_name: 'app'\n    static_configs:\n      - targets: ['localhost:3000']\n"})}),"\n",(0,i.jsx)(n.h3,{id:"instrumenting-your-application",children:"Instrumenting Your Application"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Node.js Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\nconst promClient = require('prom-client');\n\nconst app = express();\n\n// Create a Registry\nconst register = new promClient.Registry();\n\n// Add default metrics\npromClient.collectDefaultMetrics({ register });\n\n// Custom metrics\nconst httpRequestDuration = new promClient.Histogram({\n  name: 'http_request_duration_seconds',\n  help: 'Duration of HTTP requests in seconds',\n  labelNames: ['method', 'route', 'status_code'],\n  registers: [register]\n});\n\n// Middleware to measure request duration\napp.use((req, res, next) => {\n  const end = httpRequestDuration.startTimer();\n  res.on('finish', () => {\n    end({ method: req.method, route: req.path, status_code: res.statusCode });\n  });\n  next();\n});\n\n// Metrics endpoint\napp.get('/metrics', async (req, res) => {\n  res.set('Content-Type', register.contentType);\n  res.end(await register.metrics());\n});\n\napp.listen(3000);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"promql-queries",children:"PromQL Queries"}),"\n",(0,i.jsx)(n.p,{children:"Common Prometheus queries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-promql",children:'# CPU usage\nrate(cpu_usage_seconds_total[5m])\n\n# Memory usage\nprocess_resident_memory_bytes / 1024 / 1024\n\n# HTTP request rate\nrate(http_requests_total[5m])\n\n# 95th percentile response time\nhistogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))\n\n# Error rate\nrate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m])\n'})}),"\n",(0,i.jsx)(n.h2,{id:"grafana",children:"Grafana"}),"\n",(0,i.jsx)(n.h3,{id:"installation-1",children:"Installation"}),"\n",(0,i.jsx)(n.p,{children:"Using Docker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  -p 3000:3000 \\\n  --name=grafana \\\n  grafana/grafana\n"})}),"\n",(0,i.jsx)(n.h3,{id:"connecting-to-prometheus",children:"Connecting to Prometheus"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Navigate to Configuration \u2192 Data Sources"}),"\n",(0,i.jsx)(n.li,{children:"Add Prometheus data source"}),"\n",(0,i.jsxs)(n.li,{children:["Set URL to ",(0,i.jsx)(n.code,{children:"http://prometheus:9090"})]}),"\n",(0,i.jsx)(n.li,{children:'Click "Save & Test"'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-dashboards",children:"Creating Dashboards"}),"\n",(0,i.jsx)(n.p,{children:"Example dashboard JSON:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "dashboard": {\n    "title": "Application Metrics",\n    "panels": [\n      {\n        "title": "Request Rate",\n        "targets": [\n          {\n            "expr": "rate(http_requests_total[5m])"\n          }\n        ],\n        "type": "graph"\n      },\n      {\n        "title": "Error Rate",\n        "targets": [\n          {\n            "expr": "rate(http_requests_total{status=~\\"5..\\"}[5m])"\n          }\n        ],\n        "type": "graph"\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"popular-community-dashboards",children:"Popular Community Dashboards"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Node Exporter Full (ID: 1860)"}),"\n",(0,i.jsx)(n.li,{children:"Kubernetes Cluster Monitoring (ID: 7249)"}),"\n",(0,i.jsx)(n.li,{children:"Docker Container Metrics (ID: 193)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"elk-stack-elasticsearch-logstash-kibana",children:"ELK Stack (Elasticsearch, Logstash, Kibana)"}),"\n",(0,i.jsx)(n.h3,{id:"docker-compose-setup",children:"Docker Compose Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0\n    environment:\n      - discovery.type=single-node\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n    ports:\n      - "9200:9200"\n    volumes:\n      - elasticsearch-data:/usr/share/elasticsearch/data\n\n  logstash:\n    image: docker.elastic.co/logstash/logstash:8.11.0\n    ports:\n      - "5000:5000"\n    volumes:\n      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf\n    depends_on:\n      - elasticsearch\n\n  kibana:\n    image: docker.elastic.co/kibana/kibana:8.11.0\n    ports:\n      - "5601:5601"\n    depends_on:\n      - elasticsearch\n\nvolumes:\n  elasticsearch-data:\n'})}),"\n",(0,i.jsx)(n.h3,{id:"logstash-configuration",children:"Logstash Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"logstash.conf"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:'input {\n  tcp {\n    port => 5000\n    codec => json\n  }\n}\n\nfilter {\n  if [level] == "ERROR" {\n    mutate {\n      add_tag => ["error"]\n    }\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => ["elasticsearch:9200"]\n    index => "app-logs-%{+YYYY.MM.dd}"\n  }\n  stdout {\n    codec => rubydebug\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"application-logging",children:"Application Logging"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Node.js with Winston:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const winston = require('winston');\nconst LogstashTransport = require('winston-logstash-transport').LogstashTransport;\n\nconst logger = winston.createLogger({\n  transports: [\n    new LogstashTransport({\n      host: 'logstash',\n      port: 5000\n    })\n  ]\n});\n\nlogger.info('Application started');\nlogger.error('An error occurred', { error: err.message });\n"})}),"\n",(0,i.jsx)(n.h2,{id:"loki-lightweight-alternative-to-elk",children:"Loki (Lightweight Alternative to ELK)"}),"\n",(0,i.jsx)(n.h3,{id:"docker-compose-with-loki",children:"Docker Compose with Loki"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  loki:\n    image: grafana/loki:latest\n    ports:\n      - "3100:3100"\n    volumes:\n      - ./loki-config.yaml:/etc/loki/local-config.yaml\n\n  promtail:\n    image: grafana/promtail:latest\n    volumes:\n      - /var/log:/var/log\n      - ./promtail-config.yaml:/etc/promtail/config.yaml\n\n  grafana:\n    image: grafana/grafana:latest\n    ports:\n      - "3000:3000"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"alerting",children:"Alerting"}),"\n",(0,i.jsx)(n.h3,{id:"prometheus-alerting-rules",children:"Prometheus Alerting Rules"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"alerts.yml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: application_alerts\n    rules:\n      - alert: HighErrorRate\n        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05\n        for: 5m\n        labels:\n          severity: critical\n        annotations:\n          summary: "High error rate detected"\n          description: "Error rate is {{ $value }} for {{ $labels.instance }}"\n\n      - alert: HighMemoryUsage\n        expr: (process_resident_memory_bytes / 1024 / 1024) > 500\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          summary: "High memory usage"\n          description: "Memory usage is {{ $value }}MB"\n\n      - alert: ServiceDown\n        expr: up == 0\n        for: 1m\n        labels:\n          severity: critical\n        annotations:\n          summary: "Service is down"\n          description: "{{ $labels.instance }} is down"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"alertmanager-configuration",children:"Alertmanager Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"global:\n  resolve_timeout: 5m\n\nroute:\n  group_by: ['alertname', 'cluster']\n  group_wait: 10s\n  group_interval: 10s\n  repeat_interval: 12h\n  receiver: 'default'\n\nreceivers:\n  - name: 'default'\n    email_configs:\n      - to: 'alerts@example.com'\n        from: 'prometheus@example.com'\n        smarthost: smtp.gmail.com:587\n        auth_username: 'prometheus@example.com'\n        auth_password: 'password'\n\n  - name: 'slack'\n    slack_configs:\n      - api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'\n        channel: '#alerts'\n        title: 'Alert: {{ .GroupLabels.alertname }}'\n        text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"1-label-cardinality",children:"1. Label Cardinality"}),"\n",(0,i.jsx)(n.p,{children:"Avoid high-cardinality labels:"}),"\n",(0,i.jsxs)(n.p,{children:["\u274c ",(0,i.jsx)(n.strong,{children:"Don't:"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"counter.inc({ user_id: userId }); // Too many unique values\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Do:"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"counter.inc({ user_type: userType }); // Limited set of values\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-structured-logging",children:"2. Structured Logging"}),"\n",(0,i.jsx)(n.p,{children:"Always use structured logs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"logger.info('User login', {\n  userId: user.id,\n  ip: req.ip,\n  timestamp: new Date().toISOString()\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-log-levels",children:"3. Log Levels"}),"\n",(0,i.jsx)(n.p,{children:"Use appropriate log levels:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DEBUG"}),": Detailed diagnostic information"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"INFO"}),": General informational messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"WARN"}),": Warning messages for potentially harmful situations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ERROR"}),": Error events that might still allow the application to continue"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FATAL"}),": Severe errors that cause premature termination"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-sampling",children:"4. Sampling"}),"\n",(0,i.jsx)(n.p,{children:"For high-traffic applications, sample logs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"if (Math.random() < 0.1) { // 10% sampling\n  logger.debug('Request processed', { requestId });\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5-retention-policies",children:"5. Retention Policies"}),"\n",(0,i.jsx)(n.p,{children:"Set appropriate data retention:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Prometheus\nstorage:\n  tsdb:\n    retention.time: 15d\n    retention.size: 50GB\n"})}),"\n",(0,i.jsx)(n.h2,{id:"distributed-tracing",children:"Distributed Tracing"}),"\n",(0,i.jsx)(n.h3,{id:"jaeger-setup",children:"Jaeger Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  jaeger:\n    image: jaegertracing/all-in-one:latest\n    ports:\n      - "5775:5775/udp"\n      - "6831:6831/udp"\n      - "6832:6832/udp"\n      - "5778:5778"\n      - "16686:16686"\n      - "14268:14268"\n      - "14250:14250"\n      - "9411:9411"\n    environment:\n      - COLLECTOR_ZIPKIN_HTTP_PORT=9411\n'})}),"\n",(0,i.jsx)(n.h3,{id:"opentelemetry-integration",children:"OpenTelemetry Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const { NodeTracerProvider } = require('@opentelemetry/sdk-trace-node');\nconst { JaegerExporter } = require('@opentelemetry/exporter-jaeger');\n\nconst provider = new NodeTracerProvider();\nprovider.addSpanProcessor(\n  new SimpleSpanProcessor(\n    new JaegerExporter({\n      serviceName: 'my-service',\n    })\n  )\n);\nprovider.register();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../",children:"DevOps Overview"})," - Introduction to DevOps practices"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);