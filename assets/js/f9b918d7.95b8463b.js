"use strict";(globalThis.webpackChunkmy_profile_site=globalThis.webpackChunkmy_profile_site||[]).push([[5999],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},48106:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"design-patterns/behavioral/visitor","title":"Visitor Pattern","description":"Represent an operation to be performed on elements of an object structure. Visitor lets you define a new operation without changing the classes of the elements on which it operates.","source":"@site/docs/design-patterns/behavioral/visitor.md","sourceDirName":"design-patterns/behavioral","slug":"/design-patterns/behavioral/visitor","permalink":"/docs/design-patterns/behavioral/visitor","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Memento Pattern","permalink":"/docs/design-patterns/behavioral/memento"},"next":{"title":"Class and Object Patterns","permalink":"/docs/design-patterns/class-and-object-patterns"}}');var s=t(74848),r=t(28453);const o={sidebar_position:11},l="Visitor Pattern",a={},c=[{value:"Problem",id:"problem",level:2},{value:"Design Principles Applied",id:"design-principles-applied",level:2},{value:"Double Dispatch",id:"double-dispatch",level:2},{value:"UML Diagram",id:"uml-diagram",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Example 1: Shopping Cart with Tax and Discount Visitors",id:"example-1-shopping-cart-with-tax-and-discount-visitors",level:3},{value:"Step 1: Define the Element Interface",id:"step-1-define-the-element-interface",level:3},{value:"Step 2: Define the Visitor Interface",id:"step-2-define-the-visitor-interface",level:3},{value:"Step 3: Create Concrete Elements",id:"step-3-create-concrete-elements",level:3},{value:"Step 4: Create Concrete Visitors",id:"step-4-create-concrete-visitors",level:3},{value:"Step 5: Client Usage",id:"step-5-client-usage",level:3},{value:"When to Use vs Avoid",id:"when-to-use-vs-avoid",level:2},{value:"Real-World Examples",id:"real-world-examples",level:2},{value:"Visitor vs Similar Patterns",id:"visitor-vs-similar-patterns",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"visitor-pattern",children:"Visitor Pattern"})}),"\n",(0,s.jsx)(n.p,{children:"Represent an operation to be performed on elements of an object structure. Visitor lets you define a new operation without changing the classes of the elements on which it operates."}),"\n",(0,s.jsx)(n.h2,{id:"problem",children:"Problem"}),"\n",(0,s.jsx)(n.p,{children:"You have a stable object structure (e.g. a tree of nodes) and you need to perform many distinct, unrelated operations on it. Adding each operation directly to the element classes pollutes them with unrelated concerns and requires modifying every class each time a new operation is needed."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Common Scenarios:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Running multiple analysis passes over an AST (abstract syntax tree)"}),"\n",(0,s.jsx)(n.li,{children:"Calculating different metrics over a file system hierarchy"}),"\n",(0,s.jsx)(n.li,{children:"Exporting a document model to different formats (HTML, PDF, plain text)"}),"\n",(0,s.jsx)(n.li,{children:"Applying tax or discount rules to items in a shopping cart"}),"\n",(0,s.jsx)(n.li,{children:"Code generation, linting, and type-checking over the same node tree"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"design-principles-applied",children:"Design Principles Applied"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Open/Closed Principle"})," - Add new operations by adding new Visitor classes, not modifying elements"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Single Responsibility"})," - Each visitor encapsulates one operation across all element types"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Separation of Concerns"})," - Algorithm logic is separated from the object structure it operates on"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"double-dispatch",children:"Double Dispatch"}),"\n",(0,s.jsxs)(n.p,{children:["The key mechanism in Visitor is ",(0,s.jsx)(n.strong,{children:"double dispatch"})," \u2014 the operation that runs depends on both the type of the Visitor ",(0,s.jsx)(n.em,{children:"and"})," the type of the Element:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Client calls ",(0,s.jsx)(n.code,{children:"element.accept(visitor)"})," \u2014 dispatch on element type"]}),"\n",(0,s.jsxs)(n.li,{children:["Element calls ",(0,s.jsx)(n.code,{children:"visitor.visit(this)"})," \u2014 dispatch on visitor type"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This ensures the correct ",(0,s.jsx)(n.code,{children:"visit"})," overload is called without requiring ",(0,s.jsx)(n.code,{children:"instanceof"})," checks."]}),"\n",(0,s.jsx)(n.h2,{id:"uml-diagram",children:"UML Diagram"}),"\n",(0,s.jsx)(n.mermaid,{value:'classDiagram\n    class Visitor {\n        <<interface>>\n        +visitConcreteElementA(ConcreteElementA)\n        +visitConcreteElementB(ConcreteElementB)\n    }\n    class ConcreteVisitor {\n        +visitConcreteElementA(ConcreteElementA)\n        +visitConcreteElementB(ConcreteElementB)\n    }\n    class Element {\n        <<interface>>\n        +accept(Visitor)\n    }\n    class ConcreteElementA {\n        +accept(Visitor)\n        +operationA()\n    }\n    class ConcreteElementB {\n        +accept(Visitor)\n        +operationB()\n    }\n    class Client {\n        <<actor>>\n    }\n    note for Client "Represents any code that uses the pattern, not a concrete class"\n    Client --\x3e Element\n    Visitor <|.. ConcreteVisitor : implements\n    Element <|.. ConcreteElementA : implements\n    Element <|.. ConcreteElementB : implements\n    ConcreteElementA --\x3e Visitor : accept\n    ConcreteElementB --\x3e Visitor : accept'}),"\n",(0,s.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"example-1-shopping-cart-with-tax-and-discount-visitors",children:"Example 1: Shopping Cart with Tax and Discount Visitors"}),"\n",(0,s.jsx)(n.p,{children:"Two separate operations (tax calculation and discount reporting) over the same cart items."}),"\n",(0,s.jsx)(n.h3,{id:"step-1-define-the-element-interface",children:"Step 1: Define the Element Interface"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public interface CartItem {\n    String getName();\n    double getPrice();\n    void accept(CartVisitor visitor);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-define-the-visitor-interface",children:"Step 2: Define the Visitor Interface"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public interface CartVisitor {\n    void visit(Book book);\n    void visit(Electronics electronics);\n    void visit(Clothing clothing);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-3-create-concrete-elements",children:"Step 3: Create Concrete Elements"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public class Book implements CartItem {\n    private String name;\n    private double price;\n    private boolean isEducational;\n\n    public Book(String name, double price, boolean isEducational) {\n        this.name = name;\n        this.price = price;\n        this.isEducational = isEducational;\n    }\n\n    public boolean isEducational() { return isEducational; }\n\n    @Override\n    public String getName() { return name; }\n\n    @Override\n    public double getPrice() { return price; }\n\n    @Override\n    public void accept(CartVisitor visitor) {\n        visitor.visit(this); // double dispatch \u2014 calls visit(Book)\n    }\n}\n\npublic class Electronics implements CartItem {\n    private String name;\n    private double price;\n\n    public Electronics(String name, double price) {\n        this.name = name;\n        this.price = price;\n    }\n\n    @Override\n    public String getName() { return name; }\n\n    @Override\n    public double getPrice() { return price; }\n\n    @Override\n    public void accept(CartVisitor visitor) {\n        visitor.visit(this); // double dispatch \u2014 calls visit(Electronics)\n    }\n}\n\npublic class Clothing implements CartItem {\n    private String name;\n    private double price;\n\n    public Clothing(String name, double price) {\n        this.name = name;\n        this.price = price;\n    }\n\n    @Override\n    public String getName() { return name; }\n\n    @Override\n    public double getPrice() { return price; }\n\n    @Override\n    public void accept(CartVisitor visitor) {\n        visitor.visit(this); // double dispatch \u2014 calls visit(Clothing)\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-4-create-concrete-visitors",children:"Step 4: Create Concrete Visitors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// Visitor 1: Calculate total tax\npublic class TaxVisitor implements CartVisitor {\n    private double totalTax = 0;\n\n    @Override\n    public void visit(Book book) {\n        // Educational books are tax-exempt\n        double tax = book.isEducational() ? 0 : book.getPrice() * 0.05;\n        totalTax += tax;\n        System.out.printf("Tax on %s: %.2f%n", book.getName(), tax);\n    }\n\n    @Override\n    public void visit(Electronics electronics) {\n        double tax = electronics.getPrice() * 0.18;\n        totalTax += tax;\n        System.out.printf("Tax on %s: %.2f%n", electronics.getName(), tax);\n    }\n\n    @Override\n    public void visit(Clothing clothing) {\n        double tax = clothing.getPrice() * 0.12;\n        totalTax += tax;\n        System.out.printf("Tax on %s: %.2f%n", clothing.getName(), tax);\n    }\n\n    public double getTotalTax() { return totalTax; }\n}\n\n// Visitor 2: Apply discounts\npublic class DiscountVisitor implements CartVisitor {\n    private double totalDiscount = 0;\n\n    @Override\n    public void visit(Book book) {\n        double discount = book.getPrice() * 0.10; // 10% off books\n        totalDiscount += discount;\n        System.out.printf("Discount on %s: %.2f%n", book.getName(), discount);\n    }\n\n    @Override\n    public void visit(Electronics electronics) {\n        double discount = electronics.getPrice() * 0.05; // 5% off electronics\n        totalDiscount += discount;\n        System.out.printf("Discount on %s: %.2f%n", electronics.getName(), discount);\n    }\n\n    @Override\n    public void visit(Clothing clothing) {\n        double discount = clothing.getPrice() * 0.20; // 20% off clothing\n        totalDiscount += discount;\n        System.out.printf("Discount on %s: %.2f%n", clothing.getName(), discount);\n    }\n\n    public double getTotalDiscount() { return totalDiscount; }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"step-5-client-usage",children:"Step 5: Client Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'List<CartItem> cart = List.of(\n    new Book("Clean Code", 35.00, false),\n    new Book("Java Textbook", 60.00, true),\n    new Electronics("Headphones", 120.00),\n    new Clothing("T-Shirt", 25.00)\n);\n\nTaxVisitor taxVisitor = new TaxVisitor();\ncart.forEach(item -> item.accept(taxVisitor));\nSystem.out.printf("Total tax: %.2f%n%n", taxVisitor.getTotalTax());\n\nDiscountVisitor discountVisitor = new DiscountVisitor();\ncart.forEach(item -> item.accept(discountVisitor));\nSystem.out.printf("Total discount: %.2f%n", discountVisitor.getTotalDiscount());\n'})}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use-vs-avoid",children:"When to Use vs Avoid"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Visitor when:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The object structure is stable but you frequently add new operations"}),"\n",(0,s.jsx)(n.li,{children:"You need many distinct, unrelated operations over the same structure"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Avoid Visitor when:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"New element types are added frequently \u2014 every new element requires updating all visitors"}),"\n",(0,s.jsx)(n.li,{children:"The object structure is simple \u2014 the pattern adds significant boilerplate for little gain"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"real-world-examples",children:"Real-World Examples"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Java compiler (",(0,s.jsx)(n.code,{children:"javax.lang.model"}),")"]})," \u2014 ",(0,s.jsx)(n.code,{children:"ElementVisitor"})," visits annotation processing elements"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ASM bytecode library"})," \u2014 ",(0,s.jsx)(n.code,{children:"ClassVisitor"}),", ",(0,s.jsx)(n.code,{children:"MethodVisitor"}),", ",(0,s.jsx)(n.code,{children:"FieldVisitor"})," traverse JVM bytecode"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Apache POI"})," \u2014 visitor-style traversal of Excel/Word document elements"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ANTLR-generated parsers"})," \u2014 generated visitor classes walk parse tree nodes"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"visitor-vs-similar-patterns",children:"Visitor vs Similar Patterns"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Adding new operations"}),(0,s.jsx)(n.th,{children:"Adding new element types"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Visitor"})}),(0,s.jsx)(n.td,{children:"Easy \u2014 add a new Visitor class"}),(0,s.jsx)(n.td,{children:"Hard \u2014 update every Visitor"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Strategy"})}),(0,s.jsx)(n.td,{children:"N/A \u2014 one algorithm, swappable"}),(0,s.jsx)(n.td,{children:"N/A \u2014 no element hierarchy"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Iterator"})}),(0,s.jsx)(n.td,{children:"Separates traversal, not operations"}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Composite"})}),(0,s.jsx)(n.td,{children:"Defines structure, not operations"}),(0,s.jsx)(n.td,{children:"Easy \u2014 add a new leaf/composite"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Interpreter"})}),(0,s.jsx)(n.td,{children:"Same tree structure, grammar-focused"}),(0,s.jsx)(n.td,{children:"Hard \u2014 update all interpreters"})]})]})]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);